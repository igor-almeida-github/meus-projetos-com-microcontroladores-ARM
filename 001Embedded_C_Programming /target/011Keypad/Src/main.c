/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * <h2><center>&copy; Copyright (c) 2021 STMicroelectronics.
 * All rights reserved.</center></h2>
 *
 * This software component is licensed by ST under BSD 3-Clause license,
 * the "License"; You may not use this file except in compliance with the
 * License. You may obtain a copy of the License at:
 *                        opensource.org/licenses/BSD-3-Clause
 *
 ******************************************************************************
 */

#include <stdint.h>
#include <stdio.h>

int main(void)
{
	uint32_t volatile *const pRCC_AHB1ENR = (uint32_t *)0x40023830;
	uint32_t volatile *const pGPIOD_MODER = (uint32_t *)0x40020C00;
	uint32_t volatile *const pGPIOD_ODR = (uint32_t *)0x40020C14;
	uint32_t const volatile *const pGPIOD_IDR = (uint32_t *)0x40020C10;
	uint32_t volatile *const pGPIOD_PUPDR = (uint32_t *)0x40020C0C;


	*pRCC_AHB1ENR |= (1 << 3);  // Clock ativado para GPIOD
	*pGPIOD_MODER |= 0x15;  // General purpose output mode nos pinos PD0, PD1 e PD2
	*pGPIOD_PUPDR |= (1 << 22) | (1 << 20) | (1 << 18) | (1 << 16); // Pull up em PD8-PD11
	*pGPIOD_ODR |= 0x07;  // PD0, PD1, PD2 Alto

	for(;;){

		// Coluna 1
		*pGPIOD_ODR |= (1 << 2);  // PD2 Alto
		*pGPIOD_ODR &= ~(1 << 0);  // PD0 Baixo

		switch ((*pGPIOD_IDR >> 8) & 0x0F){

			case 0b1110:  // Linha 1
				printf("1\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1101:  // Linha 2
				printf("4\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1011:  // Linha 3
				printf("7\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b0111:  // Linha 4
				printf("*\n");
				for(uint32_t i=0; i<300000; i++);
				break;

		}

		// Coluna 2
		*pGPIOD_ODR |= (1 << 0);  // PD0 Alto
		*pGPIOD_ODR &= ~(1 << 1);  // PD1 Baixo

		switch ((*pGPIOD_IDR >> 8) & 0x0F){

			case 0b1110:  // Linha 1
				printf("2\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1101:  // Linha 2
				printf("5\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1011:  // Linha 3
				printf("8\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b0111:  // Linha 4
				printf("0\n");
				for(uint32_t i=0; i<300000; i++);
				break;

		}

		// Coluna 3
		*pGPIOD_ODR |= (1 << 1);  // PD1 Alto
		*pGPIOD_ODR &= ~(1 << 2);  // PD2 Baixo

		switch ((*pGPIOD_IDR >> 8) & 0x0F){

			case 0b1110:  // Linha 1
				printf("3\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1101:  // Linha 2
				printf("6\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b1011:  // Linha 3
				printf("9\n");
				for(uint32_t i=0; i<300000; i++);
				break;

			case 0b0111:  // Linha 4
				printf("#\n");
				for(uint32_t i=0; i<300000; i++);
				break;

		}

	}  // End for
}  // End main

